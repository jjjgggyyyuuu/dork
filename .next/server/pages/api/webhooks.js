"use strict";(()=>{var e={};e.id=857,e.ids=[857],e.modules={4217:e=>{e.exports=require("micro")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6090:e=>{e.exports=import("stripe")},6840:(e,t,o)=>{o.a(e,async(e,r)=>{try{o.r(t),o.d(t,{config:()=>l,default:()=>d,routeModule:()=>u});var a=o(1802),s=o(7153),n=o(6249),c=o(2046),i=e([c]);c=(i.then?(await i)():i)[0];let d=(0,n.l)(c,"default"),l=(0,n.l)(c,"config"),u=new a.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/webhooks",pathname:"/api/webhooks",bundlePath:"",filename:""},userland:c});r()}catch(e){r(e)}})},2046:(e,t,o)=>{o.a(e,async(e,r)=>{try{o.r(t),o.d(t,{config:()=>d,default:()=>handler});var a=o(6090),s=o(4217),n=e([a]);a=(n.then?(await n)():n)[0];let c=new a.default(process.env.STRIPE_SECRET_KEY),i=process.env.STRIPE_WEBHOOK_SECRET,d={api:{bodyParser:!1}};async function handler(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let o;let r=await (0,s.buffer)(e),a=e.headers["stripe-signature"];if(!i)return console.error("Stripe webhook secret is not configured"),t.status(500).json({message:"Webhook secret is not configured",error:"Missing STRIPE_WEBHOOK_SECRET environment variable"});try{o=c.webhooks.constructEvent(r.toString(),a,i)}catch(e){return console.error(`Webhook signature verification failed: ${e.message}`),t.status(400).send(`Webhook Error: ${e.message}`)}switch(o.type){case"customer.subscription.created":let n=o.data.object;console.log("Subscription created:",n);break;case"customer.subscription.updated":let d=o.data.object;console.log("Subscription updated:",d);break;case"customer.subscription.deleted":let l=o.data.object;console.log("Subscription deleted:",l);break;case"checkout.session.completed":let u=o.data.object;console.log("Checkout completed:",u);break;case"invoice.payment_succeeded":let p=o.data.object;console.log("Invoice paid:",p);break;case"invoice.payment_failed":let b=o.data.object;console.log("Invoice payment failed:",b);break;default:console.log(`Unhandled event type: ${o.type}`)}return t.status(200).json({received:!0})}catch(e){return console.error("Webhook error:",e),t.status(500).json({message:"Webhook handler failed",error:e.message})}}r()}catch(e){r(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),o=t.X(0,[222],()=>__webpack_exec__(6840));module.exports=o})();